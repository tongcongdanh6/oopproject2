@using DOANLTHDT_1988216.Controllers
@using DOANLTHDT_1988216.Entities
@using DOANLTHDT_1988216.Functions

@{
    Layout = "_Layout.cshtml";
    Page.Title = "Cập nhật mặt hàng";

    c_MatHang c_MatHang = new c_MatHang();
    c_LoaiHang c_LoaiHang = new c_LoaiHang();

    List<MatHang> dsMH = new List<MatHang>();
    List<MatHang> result = new List<MatHang>();

    // Khởi tạo các biến cần thiết
    List<LoaiHang> dsLH = new List<LoaiHang>();
    MatHang currentMH = null;

    // Message lưu kết quả thông báo trả về
    List<Message> msg = new List<Message>();

    if (!String.IsNullOrEmpty(Request["id"]))
    {
        dsLH = c_LoaiHang.getDanhSachLoaiHang();
        if (!int.TryParse(Request["id"], out int r)){
            msg.Add(new Message("warning", String.Format("{0} {1} {2}", Constants.MA, Constants.MAT_HANG, Constants.KHONG_HOP_LE)));
        }
        else
        {
            currentMH = c_MatHang.getMatHangById(Request["id"]);
        }

        if (currentMH == null)
        {
            msg.Add(new Message("warning", String.Format("{0} {1} {2}", Constants.KHONG_TIM_THAY_MAT_HANG, Constants.DE, Constants.CAP_NHAT)));
        }

        // Nếu submit dữ liệu
        if (IsPost)
        {
            msg = c_MatHang.capNhatMatHang(
                 Request["id"],
                 Request["ten_mat_hang"],
                 Request["nha_sx"],
                 Request["han_sd"],
                 Request["nam_sx"],
                 Request["loai_hang"]
                 );

            if (msg.Count == 1 && msg[0].TYPE == "success")
            {
                Response.Redirect("~/Views/v_DanhSachMatHang.cshtml");
            }
        }
    }
    else
    {
        msg.Add(new Message("info", String.Format("{0} {1} {2} {3}",
            Constants.VUI_LONG_CHON,
            Constants.MAT_HANG,
            Constants.DE,
            Constants.CAP_NHAT)));
    }
}

<div class="container">
    <div class="row py-5 justify-content-center">
        <div class="col-md-6">
            <h1 class="text-center">Cập nhật mặt hàng</h1>
            @{
                if (msg.Count > 0)
                {
                    foreach (var m in msg)
                    {
                        <div class="alert alert-@m.TYPE">@m.CONTENT</div>
                    }
                }
            }
            @{ if (currentMH != null)
                {
                    <form action="~/Views/v_SuaMatHang.cshtml?id=@currentMH.MA_MAT_HANG" method="post">
                        <label for="ten_mat_hang">Tên mặt hàng</label>
                        <input class="form-control" type="text" name="ten_mat_hang" placeholder="Tên mặt hàng" value="@currentMH.TEN_MAT_HANG" /><br />
                        <label for="nha_sx">Nhà sản xuất</label>
                        <input class="form-control" type="text" name="nha_sx" placeholder="Nhà sản xuất" value="@currentMH.CONG_TY_SX" /><br />
                        <label for="han_sd">Hạn sử dụng</label>
                        <input class="form-control" type="date" name="han_sd" placeholder="Hạn sử dụng" value="@currentMH.HAN_SU_DUNG.ToString("yyyy-MM-dd")" /><br />
                        <label for="nam_sx">Năm sản xuất</label>
                        <input class="form-control" type="date" name="nam_sx" placeholder="Năm sản xuất" value="@currentMH.NAM_SX.ToString("yyyy-MM-dd")" /><br />
                        <label for="loai_hang">Loại hàng</label>
                        <select class="form-control" name="loai_hang">
                            @{
                                foreach (var lh in dsLH)
                                {
                                    <option value=@lh.MA_LOAI_HANG @{ if (int.Parse(Request["id"]) == lh.MA_LOAI_HANG) { @Html.Raw("selected")  } }>@lh.TEN_LOAI_HANG</option>
                                }
                            }
                        </select>
                        <div class="text-center py-3">
                            <button class="btn btn-primary" type="submit">Sửa mặt hàng</button>
                        </div>
                    </form>
                }}
            @{
                if (msg != null)
                {
                    
                }
            }
        </div>
    </div>

</div>